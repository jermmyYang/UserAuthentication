(function(e){"use strict";var t=e.$,n='<div class="quc-mod-sign-up quc-clearfix"><div class="quc-left-bar"><ul class="quc-sign-up-type"></ul></div><div class="quc-main"><div class="quc-tip-wrapper quc-global-error"><p class="quc-tip quc-tip-error"></p></div><form class="quc-form" method="post" action="'+QHDomain.i360+'/signUp/dosignUpAccount">'+'<p class="quc-field-submit">'+'<input class="quc-button quc-button-sign-up" type="submit" value="\u7acb\u5373\u6ce8\u518c" />'+"</p>"+'<p class="quc-field-licence">'+"<label>"+'<input class="quc-checkbox" type="checkbox" name="is_agree" data-name="agreeLicence" checked="checked">'+'<span style="font-size:12px;">'+"\u6211\u5df2\u7ecf\u9605\u8bfb\u5e76\u540c\u610f"+'<a class="quc-link green" href="'+QHDomain.i360+'/pub/protocol.html" target="_blank">\u300a360\u7528\u6237\u670d\u52a1\u6761\u6b3e\u300b</a>'+"</span>"+"</label>"+"</p>"+'<p class="quc-login">'+'\u5df2\u6709\u5e10\u53f7\uff0c<a href="#" class="quc-link quc-link-login">\u7acb\u5373\u767b\u5f55</a>'+"</p>"+"</form>"+"</div>"+"</div>",r={mobile:'<div class="quc-field quc-field-mobile quc-input-middle quc-clearfix" style="margin-bottom:10px;border-bottom: none;"><span class="quc-ipbox" style="display: block"><label class="quc-label">\u624b\u673a\u53f7</label><span class="quc-input-bg"><input class="quc-input quc-input-mobile" type="tel" name="account" data-name="mobile" maxlength="11"></span><span class="tipwrapper-phoneReg msgtipsleft" style="top:55px;left:518px;"><i class="ico ico-err-3"></i><span class="border-right msgtipsright"><span id="tips-phoneReg" class="text-tips tips-phoneReg reg-tips-wrong"><span class="quc-tip">\u8bf7\u8f93\u5165\u60a8\u7684\u624b\u673a\u53f7\u7801</a> </span></span></span></span></span><a href="#" class="quc-button quc-button-blue quc-get-sms-token">\u514d\u8d39\u83b7\u53d6\u6821\u9a8c\u7801</a><a class="quc-mobile-tip quc-link" href="'+QHDomain.i360+'/help/smscode" target="_blank" tabindex="99">\u6821\u9a8c\u7801\u5e38\u89c1\u95ee\u9898</a>'+"</div>",email:'<div class="quc-field quc-field-email quc-input-long"><label class="quc-label">\u90ae\u7bb1</label><span class="quc-input-bg"><input class="quc-input quc-input-email" type="text" name="account" data-name="email" autocomplete="off"/></span><span class="tipwrapper-phoneReg msgtipsleft"><i class="ico ico-err-3"></i><span class="border-right msgtipsright"><span id="tips-phoneReg" class="text-tips tips-phoneReg reg-tips-wrong"><span class="quc-tip">\u8bf7\u8f93\u5165\u60a8\u7684\u5e38\u7528\u90ae\u7bb1\uff0c<a class="quc-link" href="http://reg.email.163.com/" target="_blank" tabindex="99">\u6ca1\u6709\u90ae\u7bb1?</a> </span></span></span></span></div>',username:'<div class="quc-field quc-field-username quc-input-long"><label class="quc-label">\u7528\u6237\u540d</label><span class="quc-input-bg"><input class="quc-input quc-input-username" type="text" name="userName" data-name="username" maxlength="14" /></span><span class="tipwrapper-phoneReg msgtipsleft"><i class="ico ico-err-3"></i><span class="border-right msgtipsright"><span id="tips-phoneReg" class="text-tips tips-phoneReg reg-tips-wrong"><span class="quc-tip">2-14\u4e2a\u5b57\u7b26\uff1a\u82f1\u6587\u3001\u6570\u5b57\u6216\u4e2d\u6587</span></span></span></span></div>',nickname:'<div class="quc-field quc-field-nickname quc-input-long"><label class="quc-label">\u6635\u79f0</label><span class="quc-input-bg"><input class="quc-input quc-input-nickname" type="text" name="nickname" maxlength="14" /></span><span class="tipwrapper-phoneReg msgtipsleft"><i class="ico ico-err-3"></i><span class="border-right msgtipsright"><span id="tips-phoneReg" class="text-tips tips-phoneReg reg-tips-wrong"><span class="quc-tip">2-14\u4e2a\u5b57\u7b26\uff1a\u82f1\u6587\u3001\u6570\u5b57\u6216\u4e2d\u6587</span></span></span></span></div>',password:'<div class="quc-field quc-field-password quc-input-long"><label class="quc-label">\u5bc6\u7801</label><span class="quc-input-bg"><input class="quc-input quc-input-password" type="password" name="password" maxlength="20" /></span><span class="tipwrapper-phoneReg errortipsleft"><i class="ico ico-err-3"></i><span class="border-right errortipsright"><span id="tips-phoneReg" class="text-tips tips-phoneReg reg-tips-wrong"><span class="quc-tip">6-20\u4e2a\u5b57\u7b26(\u533a\u5206\u5927\u5c0f\u5199)</span></span></span></span></div>',passwordAgain:'<div class="quc-field quc-field-password-again quc-input-long"><label class="quc-label">\u786e\u8ba4\u5bc6\u7801</label><span class="quc-input-bg"><input class="quc-input quc-input-password-again" type="password" name="passwordAgain" maxlength="20" /></span><span class="tipwrapper-phoneReg errortipsleft"><i class="ico ico-right"></i><span class="border-right errortipsright"><span id="tips-phoneReg" class="text-tips tips-phoneReg reg-tips-wrong"><span class="quc-tip">\u8bf7\u518d\u6b21\u8f93\u5165\u5bc6\u7801</Span></span></span></span></div>',captcha:'<div class="quc-field quc-field-captcha quc-input-short"><label class="quc-label">\u9a8c\u8bc1\u7801</label><span class="quc-input-bg"><input class="quc-input quc-input-captcha" type="text" name="captcha" maxlength="7" autocomplete="off" /></span><span class="tipwrapper-phoneReg errortipsleft"><i class="ico ico-right" style="margin-left: -165px;"></i><span class="border-right errortipsright"><span id="tips-phoneReg" class="text-tips tips-phoneReg reg-tips-wrong"><span class="quc-tip">\u8bf7\u8f93\u5165\u56fe\u7247\u4e2d\u7684\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u8ba1\u7b97\u7ed3\u679c\uff0c\u4e0d\u533a\u5206\u5927\u5c0f\u5199</Span></span></span></span><img class="quc-captcha-img quc-captcha-change" alt="\u9a8c\u8bc1\u7801" title="\u70b9\u51fb\u66f4\u6362" tabindex="99" /><a class="quc-link quc-link-captcha-change quc-captcha-change" href="#">\u6362\u4e00\u5f20</a></div>',smsToken:'<div class="quc-field quc-field-sms-token quc-input-long"><label class="quc-label">\u6821\u9a8c\u7801</label><span class="quc-input-bg"><input class="quc-input quc-input-sms-token" type="text" name="smscode" data-name="smsToken" maxlength="6" /></span><span class="tipwrapper-phoneReg errortipsleft"><i class="ico ico-right"></i><span class="border-right errortipsright"><span id="tips-phoneReg" class="text-tips tips-phoneReg reg-tips-wrong"><span class="quc-tip">\u8bf7\u8f93\u5165\u77ed\u4fe1\u4e2d6\u4f4d\u6570\u5b57\u6821\u9a8c\u7801</Span></span></span></span></div>'},i={email:{name:"\u90ae\u7bb1\u6ce8\u518c",fields:["email","username","nickname","password","passwordAgain","captcha"]},mobile:{name:"\u624b\u673a\u6ce8\u518c",fields:["mobile","smsToken","username","nickname","password","passwordAgain"]},username:{name:"\u7528\u6237\u540d\u6ce8\u518c",fields:["username","nickname","password","passwordAgain","captcha"]}},s={},o={init:function(e){this.model=e,this.initModelEvent(),this.initCaptcha(),this.initSmsToken(),this.initErrorTip()},setElement:function(){s={};var e=this;e.$el&&e.$el.remove(),e.$el=t(n),e.userType=null,e.initNav(),e.$el.on("click",".quc-link-login,.quc-button-login",function(t){t.preventDefault(),e.onSignIn()}),e.$el.find(".quc-form").submit(function(t){t.preventDefault(),e.submit()})},initModelEvent:function(){var e=this;e.model.on("show",function(t,n){e.show(n&&n.wrapper)}).on("hide",function(){e.hide()})},initCaptcha:function(){var n=this,r,i,s=function(){n.model.getCaptchaUrl("reg").then(function(e){i.find(".quc-captcha-img").attr("src",e),i.find(".quc-input-captcha").val(""),i.find(".quc-tip").removeClass("quc-tip-error").html(function(){return t(this).attr("data-default-tip")}),i.find(".quc-tip-icon").removeClass("quc-tip-icon-incorrect")})},o=function(){s(),i.show(),i.find(".quc-captcha-change").on("mousedown",function(e){e.preventDefault()}).on("click",function(e){e.preventDefault(),s(),i.find(".quc-input-captcha").focus()})};n.model.on("changeType",function(){i=n.$el.find(".quc-field-captcha");if(i.length==0)return;(r||(r=n.model.isCaptchaRequired()))&&o()}),this.model.on("invalid",function(t,n){!r&&e.utils.getErrorType(n)=="captcha"?(r=!0,o()):n.fromServer&&s()})},initSmsToken:function(){var t=this,n,r,i,s="quc-button-disabled",o=e.utils.getTimer("sign_up");o.on("timer_start",function(e,t){r.addClass(s),r.html(t+"\u79d2\u540e\u53ef\u91cd\u65b0\u83b7\u53d6")}),o.on("timer_tick",function(e,t){r.html(t+"\u79d2\u540e\u53ef\u91cd\u65b0\u83b7\u53d6")}),o.on("timer_stop",function(){r.html("\u91cd\u65b0\u83b7\u53d6\u6821\u9a8c\u7801"),r.removeClass(s)});var u=function(e){e.preventDefault();var u=r.siblings(".quc-tip-icon");if(r.hasClass(s))return;t.model.set("mobile",n.val()),r.html("\u53d1\u9001\u4e2d..."),r.addClass(s),u.hide(),t.model.sendSmsToken().done(function(){var e=i.find(".quc-tip");e.removeClass("quc-tip-error").addClass("quc-tip-success").html("\u53d1\u9001\u6210\u529f").show(),i.find(".quc-input").one("focus",function(){e.removeClass("quc-tip-success").html(e.attr("data-default-tip"))}),i.find(".tipwrapper-phoneReg").removeClass().addClass("tipwrapper-phoneReg").addClass("msgtipsleft").show(),i.find(".border-right").removeClass().addClass("border-right").addClass("msgtipsright"),i.find(".ico").removeClass("ico-err-3, ico-err-2").addClass("ico-right"),u.show(),o.start()}).fail(function(e){u.show(),r.html("\u514d\u8d39\u83b7\u53d6\u6821\u9a8c\u7801"),r.removeClass(s),e.field=t.$el.find(".quc-field-mobile"),t.model.trigger("invalid",e)})};this.model.on("changeType",function(){i=t.$form.find(".quc-field-mobile"),n=i.find(".quc-input"),r=i.find(".quc-get-sms-token");if(i.length==0)return;r.off("click",u).on("click",u),o.isRunning()&&o.resume()})},initErrorTip:function(){var e=this;e.model.on("invalid",function(t,n){var r=n.field||e.getErrorField(n.errno),i=r.find(".quc-input-bg"),s=r.find(".quc-tip"),o=r.find(".ico");r.find(".tipwrapper-phoneReg").find("span").show(),s.removeClass("quc-tip-success").addClass("quc-tip-error").html(n.errmsg).show(),r.find(".tipwrapper-phoneReg").removeClass().addClass("tipwrapper-phoneReg").addClass("errortipsleft").show(),r.find(".border-right").removeClass().addClass("border-right").addClass("errortipsright"),o.removeClass().addClass("ico").addClass("ico-err-2"),i.addClass("quc-input-bg-incorrect"),r.find(".quc-input").one("focus quc-validate",function(){s.removeClass("quc-tip-error").html(s.attr("data-default-tip")),i.removeClass("quc-input-bg-incorrect"),r.find(".tipwrapper-phoneReg").removeClass().addClass("tipwrapper-phoneReg").addClass("msgtipsleft").show(),r.find(".border-right").removeClass().addClass("border-right").addClass("msgtipsright"),o.removeClass().addClass("ico").addClass("ico-err-3")})}),e.model.on("afterShow changeType",function(){e.$el.find(".quc-global-error .quc-tip").html("")})},initNav:function(){var e=this,n=this.model.getTypes(),r=this.$el.find(".quc-left-bar").show().find(".quc-sign-up-type").empty();t.each(n,function(n,s){if(i[s]){var o=t("<a>").attr("href","#").html(i[s].name).prepend(t("<i>").addClass("quc-icon quc-icon-"+s)).click(function(t){t.preventDefault(),e.changeType(s)});t("<li>").addClass("quc-type-"+s).append(o).appendTo(r)}}),this.changeType(n[0])},onSignIn:function(){this.model.signIn()},getFieldEl:function(e){var n=this,i=r[e],s=t(i);return s.find(".quc-input").focus(function(){t(this).parent().addClass("quc-input-bg-focus")}).blur(function(){t(this).parent().removeClass("quc-input-bg-focus"),n.validate(s),s.hasClass("quc-field-password")&&n.validate(s.siblings(".quc-field-password-again")),s.hasClass("quc-field-password-again")&&n.validate(s.siblings(".quc-field-password"))}),s},getFormEl:function(n){var r=this;if(!s[n]){if(!i[n]){r.model.reportWarn("\u672a\u5b9a\u4e49\u7684\u7c7b\u522b typeConf:"+n);return}var o=t("<div>"),u=t('<div class="quc-ipbox">');t.each(i[n].fields,function(e,t){r.model.isShowField(t,n)&&(t!="mobile"?u.append(r.getFieldEl(t)):o.append(r.getFieldEl(t)))}),o.append(u),s[n]=o,e.utils.emailHint(o.find(".quc-input-email"))}return s[n][0]},getErrorField:function(t){var n=e.utils.getErrorType(t);return n=="account"?this.$form.find(".quc-field-"+this.userType):n!="other"?this.$form.find(".quc-field-"+n):this.$el.find(".quc-global-error")},changeType:function(e){var n=this.$el.find(".quc-sign-up-type .quc-type-"+e);n.length>0&&this.userType!=e&&(n.addClass("quc-current"),n.siblings(".quc-current").removeClass("quc-current"),this.$form&&this.$form.detach(),this.$form=t(this.getFormEl(e)),this.$form.prependTo(this.$el.find(".quc-form")),this.model.trigger("DOMUpdated",this.$el),this.$el.triggerHandler("QucDOMUpdated"),this.model.trigger("changeType",e),this.userType=e,this.$form.find(".quc-field .quc-tip").attr("data-default-tip",function(){return t(this).html()}),this.model.clear())},validate:function(e){var t=this,n=e.find(".quc-input"),r=n.attr("data-name")||n.attr("name"),i=n.val();if(e.length==0||i.length==0)return;n.trigger("quc-validate"),t.model.validate(r,i,!0).done(function(){var t=e.find(".ico");t.removeClass().addClass("ico").addClass("ico-right"),e.find(".tipwrapper-phoneReg").show().find("span").hide(),n.one("focus",function(){t.removeClass("ico-right")})}).fail(function(n){n.field=e,t.model.trigger("invalid",n)})},submit:function(){var e=this,n=e.$el.find(".quc-button-sign-up");e.$el.find(".quc-form input:not(:submit, :button)").each(function(n,r){var i=t(r),s=i.attr("data-name")||i.attr("name"),o=t.inArray(i.attr("type"),["checkbox","radio"])>=0?i.prop("checked"):i.val();e.model.set(s,o)}),n.prop("disabled",!0),e.model.one("invalid",function(){n.prop("disabled",!1)}),e.model.set("userType",this.userType),e.model.submit()},show:function(n){this.setElement();if(!n){var r=this.panel=new e.utils.Panel;r.setTitle(e.getConfig("signUp.panelTitle","\u6b22\u8fce\u6ce8\u518c360\u5e10\u53f7")),r.setContent(this.$el),this.model.trigger("beforeShow",this.$el[0]),r.show(),t(r).on("close",e.getConfig("signUp.panelCloseHandler",t.noop));var i=e.utils.browser;(i.ie6||i.ie7)&&r.setSize(i.ie6?564:544)}else this.model.trigger("beforeShow",this.$el[0]),t(n).addClass("quc-wrapper quc-page").empty().append(this.$el);this.model.trigger("afterShow",this.$el[0])},hide:function(){this.model.trigger("beforeHide",this.$el[0]),this.panel&&this.panel.hide(),this.model.trigger("afterHide",this.$el[0])}};e.ui.signUp={init:function(){o.init.apply(o,arguments)},changeType:function(e){o.changeType(e)}}})(QHPass)